name: Flutter Web deployment
on: 
  push:
    branches:
      - master 
jobs:
    build:
     name: Build Web
     env:
      FLUTTER_VERSION: 2.5.3
      DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
      DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      working-directory: ./smart-node
     runs-on: ubuntu-latest
     steps:
       - uses: actions/checkout@v1      
       - uses: subosito/flutter-action@v2
         with:
           flutter-version: "3.7.8"
           channel: 'stable'
           cache: true
#        - name: Get dependencies         
#          run: flutter pub get
   
#        - name: Get build        
#          run: flutter build web --release
       - name: Start Docker daemon
         run: |
           sudo systemctl start docker
  
       - name: Set up Docker Buildx
         uses: docker/setup-buildx-action@v1

       - name: Login to Docker Hub
         uses: docker/login-action@v1
         with:
          username: ${{ env.DOCKER_USERNAME }}
          password: ${{ env.DOCKER_PASSWORD }}
      
       - name: Build and Push Docker image        
         uses: docker/build-push-action@v2
         with:          
          context: .
          dockerfile: Dockerfile
          push: true
          tags: ${{ env.DOCKER_USERNAME }}/touchportal:latest

#       - name: Upload web       
#         uses: actions/upload-artifact@v2
#         with:
#           name: Build Web  
#           working-directory: ./smart_node
#           path: ./smart_node/
